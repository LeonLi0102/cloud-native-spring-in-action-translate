### 4.1.2 Profiles：特性标志和配置分组

有时，您可能希望仅在特定的条件下将 bean 加载到 Spring 上下文中。例如，您可能希望定义一个负责生成测试数据的 bean，仅当在本地工作或测试应用程序时使用。Profiles 是加载 bean 的逻辑组，仅当指定的 Profile 处于活动状态时，才将其导入 Spring 上下文。您可以激活零、一或多个文件。所有未分配给 Profile 文件的 bean 都始终是激活状态。分配给默认 Profile 文件的配置，只有当没有指定 Profile 时，才会被激活。Spring Boot 扩展了这一概念到 Property 文件，允许定义一组配置，仅在特定 Profile 文件处于活动状态时才启用。

本节介绍了 Spring 中 profiles 的两种不同用例：特性标志和配置分组。

#### 将 Profiles 用作特性标志

第一个用例是仅当指定的 Profile 文件处于活动状态时才加载一组配置 bean。部署环境不应该对分组背后的推理产生太大的影响。一个常见的错误是使用像 dev 或 prod 这样的 Profile 文件有条件地加载 bean。如果您这样做，应用程序将与环境耦合，通常不是我们想要的云原生应用程序。

考虑将应用程序部署到三个不同环境的情况（开发、测试和生产），并相应地定义三个 Profile 文件以有条件地加载某些 bean（dev、
test、prod）。这时候，您决定添加一个预发布环境，您还希望在其中启用用 prod 配置文件标记的 bean。您会怎么做呢？有两个选择。一个是在预发布环境中激活 prod （这有点儿不太合理）；另一个是更新源代码以添加一个 staging 文件，并将其分配给标记为 prod 的 bean（这打破了应用程序不变并可部署到任何环境，不需对源代码进行任何更改）。

相反，我建议使用 Profile 文件作为特性标志，与要创建的 bean 组关联以有条件地加载配置。考虑 Profile 文件提供哪些功能，并相应命名而不是考虑在哪里启用。然而，在某些情况下，一个 bean 确实需要处理特定平台上的基础设施。例如，您可能有一些 bean，仅当应用程序部署到 Kubernetes 时才应加载的（无论是预发布还是生产）。在这种情况下，可以定义 kubernetes profile。

